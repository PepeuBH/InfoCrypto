var buy, sell, currency, moeda = "";
$(function() {
    function e(e, a, c) {
        $("#" + e).html((a / c).toFixed(8))
    }
    $(".money2").mask("#.##0,00", {
        reverse: !0,
        placeholder: "0,00"
    }), $("form").submit(function(a) {

        a.preventDefault();
        const c = $(this).serializeArray();
        (currency = c[0].value).length || 0 != currency ? ($(".error").fadeOut(), currency = currency.replace(/\./gi, "").replace(",", "."), moeda != c[1].value && (moeda = c[1].value, $("#moeda").html(moeda), function(a) {
            $.ajax({
                dataType: "json",
                url: "https://api.coinbase.com/v2/prices/" + a + "-BRL/buy",
                success: function(a) {
                    buy = a.data.amount, e("buy", currency, buy)
                }
            }), $.ajax({
                dataType: "json",
                url: "https://api.coinbase.com/v2/prices/" + a + "-BRL/sell",
                success: function(a) {
                    sell = a.data.amount, e("sell", currency, sell)
                }
            })
        }(moeda)), e("buy", currency, buy), e("sell", currency, sell)) : $(".error").fadeIn()
    }), $.ajax({
        dataType: "json",
        url: "https://www.coinbase.com/api/v2/assets/prices?base=BRL&filter=listed&resolution=latest",
        success: function(e) {
            e.data.forEach(e => {
                $("#loopAtivo").append('<li><div class="ativoName"><img src = "/cript/' + e.base + '.png"><p>' + e.base + '</p></div><span class="money2">' + new Intl.NumberFormat("pt-BR", {
                    style: "currency",
                    currency: "BRL"
                }).format(e.prices.latest) + "</span></li>")
            })
        }
    })
});